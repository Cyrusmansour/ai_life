<canvas id ="life" width="600" height="600"></canvas>
<script>

m=document.getElementById("life").getContext("2d")

/* this virtual world is composed of particles */
draw=(x,y,c,s)=>{
    m.fillStyle=c;
    m.fillRect(x,y,s,s)
    }

/* Each particle is a pixel that has a position, velocity, and color */
particles=[]
particle=(x,y,c)=>{
    return{"x":x,"y":y,"vx":0,"vy":0,"color":c}
}

/* Randomly sets the initial position of each particle */
random=()=> {
    return Math.random()*500+50
}

/* Creates a group of particles */
create=(number,color)=>{
    group=[]
    for(let i=0; i < number; i++){
        group.push(particle(random(),random(),color))
        particles.push(group[i])
    }
    return group
}

/*  Intercation rule between particles 
    For simplicity, we assume each particle has a mass of 1 */ 
   // When g is negative --> Attraction
   // When g is positive --> Repulsion 
rule=(particles1, particles2, g)=>{
    for(let i=0; i < particles1.length; i++){
        fx = 0
        fy = 0

        for(let j=0; j < particles2.length; j++){
            a = particles1[i]
            b = particles2[j]
            dx = a.x - b.x
            dy = a.y - b.y

            // distance between a and b
            d = Math.sqrt(dx*dx + dy*dy)

            // gravitational force
            if(d > 0 && d < 80){
                F = g * 1/d
                fx += F*dx
                fy += F*dy
            }
        }
        // updated velocity
        a.vx = (a.vx + fx)*0.5
        a.vy = (a.vy + fy)*0.5

        // updated position according to estimated force and velocity
         a.x += a.vx
         a.y += a.vy

        // boundary condition
        if(a.x < 0 || a.x > 600){ a.vx *= -1}
        if(a.y < 0 || a.y > 600){ a.vy *= -1}
    } 
}


/* Visualization of the particles */
white = create(500,"white");
red = create(500,"red");
green = create(500,"green");
blue = create(500,"blue");


update=()=>{
    rule(red, red, -0.115)
    rule(red, green, 0.499)
    rule(red, blue, -0.22)
    rule(green, green, 0.499)
    rule(green, blue, -0.815)
    rule(blue, blue, -0.2)
    rule(blue, red, 0.15)
    rule(blue, green, 0.155)
    rule(blue, white, 0.25)
    rule(white, white, -1)
    rule(white, red, 0.26)
    rule(white, green, 0.14)
    m.clearRect(0,0,600,600)
    draw(0,0,"black",600)
    for(let i=0; i < particles.length; i++){
        draw(particles[i].x, particles[i].y,
        particles[i].color, 5)
    }
    requestAnimationFrame(update)
}

update();

/* 
Rule examples:
Green-eaters + stabilisation
    rule(red, red, 0.1)
    rule(red, green, -0.1)
    rule(green, red, -0.2)
    rule(green, green, -0.7)
    rule(yellow, red, 0.15) 

Clusters + nuclei
    rule(red, red, -0.1)
    rule(red, yellow, 0.01)
    rule(yellow, red, 0.01)

Chaser
    rule(green, green, -0.32)
    rule(green, red, -0.17)
    rule(green, yellow, 0.34)
    rule(red, red, -0.1)
    rule(red, green, -0.34)
    rule(yellow, yellow, 0.15)
    rule(yellow, green, -0.2)
*/

</script>